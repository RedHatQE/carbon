---

- hosts: "{{ hosts }}"

  tasks:
    - name: Install of Rhevm Admin Server Manager ( yum -y install rhevm)
      package:
        name: rhevm
        state: present
      register: result
      until: result.rc == 0
      retries: 3
      delay: 15

    - name: Find rhevm41_install_admin.yml
      local_action:
        module: find
        paths: /
        patterns: 'rhevm*.yml'
        recurse: yes
      register: find_results
    - debug: var=find_results

    - name: Find rhevm41-cleanup.j2
      local_action:
        module: find
        paths: /
        patterns: 'rhevm41*.j2'
        recurse: yes
      register: find_results
    - debug: var=find_results

    - name: Set Rhevm Cleanup File
      template: src=./templates/rhevm41-cleanup.j2
                dest=./rhevm-cleanup
      register: cleanup_file
    - debug: var=cleanup_file

    - name: Set Rhevm Answer File
      template: src=./templates/rhevm41-answer-default.j2
                dest=./rhevm-answer
      with_items:
        - { admin_fqdn: "{{ ansible_nodename }}", admin_domain: "{{ ansible_domain}}" }
      register: answer_file
    - debug: var=answer_file
 
    - name: Install of Rhevm Admin Sever Manager - engine-setup
      shell: engine-setup --config-append=rhevm-answer


