---
name: Scenario Example
description: Description of the scenario example.

provision:

  - name: machine_1
    provider: openstack
    provisioner: openstack
    credential: openstack
    os_image: rhel-7.3-workstation-x86_64-released
    os_flavor: m1.medium
    os_networks: [pit-jenkins]
    os_floating_ip_pool: 10.8.240.0
    os_keypair: pit-jenkins
    os_admin_pass:
    os_description:
    os_files:
    os_security_groups:
    ip_address:
    role: w_client

  - name: machine_2
    provider: openstack
    credential: openstack
    os_image: rhel-7.3-server-x86_64-released
    os_flavor: m1.medium
    os_networks: ['pit-jenkins']
    os_floating_ip_pool: "10.8.240.0"
    os_keypair: 'pit-jenkins'
    os_admin_pass:
    os_description:
    os_files:
    os_security_groups:
    ip_address:
    role: test_pilot

  - name: machine_3
    provider: openstack
    credential: openstack
    os_image: rhel-7.3-workstation-x86_64-released
    os_flavor: m1.medium
    os_networks: ['pit-jenkins']
    os_floating_ip_pool: "10.8.240.0"
    os_keypair: 'pit-jenkins'
    os_admin_pass:
    os_description:
    os_files:
    os_security_groups:
    ip_address:
    role: w_client

  - name: Application by image
    provider: openshift
    credential: openshift
    role: application1
    oc_image: rywillia/example
    oc_env_vars:
      var1: var1
      var2: var2
    oc_labels:
      - label1: label1
      - label2: image_app

  - name: Application by git
    provider: openshift
    provisioner: openshift
    credential: openshift
    # timeout for builds to complete, in seconds, default 30mins = 1800 sec
    oc_build_timeout: 3600
    role: application2
    oc_git: https://github.com/openshift/django-ex
    oc_env_vars:
      var1: var1
      var2: var2
    oc_labels:
      - label1: label1
      - label2: git_app

  - name: Machine from Beaker 1
    provider: beaker
    credential: beaker
    role: bkr-machine
    bkr_jobgroup: ci-ops-pit
    bkr_arch: x86_64
    bkr_variant: Workstation
    bkr_whiteboard: Testing machine provisioning from Carbon
    bkr_distro: RHEL-6.9
    bkr_host_requires_options: ["arch=x86_64", "memory>=15000"]
    bkr_key_values: ["DISKSPACE>=500000", "HVM=1"]
    bkr_kernel_options: ["selinux=--permisssive", "keyboard=us", "lang=us", "timezone=est"]
    bkr_kernel_post_options: ["isolcpus = 0,5"]
    bkr_tag: "RTT_ACCEPTED"

  - name: Machine from Beaker 2
    provider: beaker
    credential: beaker
    role: bkr-machine
    bkr_jobgroup: ci-ops-pit
    bkr_arch: x86_64
    bkr_variant: Server
    bkr_whiteboard: Testing machine provisioning from Carbon
    bkr_distro: RHEL-7.3
    bkr_host_requires_options: ["arch=x86_64", "memory>=15000"]
    bkr_key_values: ["DISKSPACE>=500000", "HVM=1"]
    bkr_kernel_options: ["selinux=--permisssive", "keyboard=us", "lang=us", "timezone=est"]
    bkr_kernel_post_options: ["isolcpus = 0,5"]
    bkr_tag: "RTT_ACCEPTED"

  - name: Machine from Beaker 3
    provider: beaker
    credential: beaker
    role: bkr-machine
    bkr_jobgroup: ci-ops-pit
    bkr_arch: x86_64
    bkr_variant: Server
    bkr_whiteboard: Testing machine provisioning from Carbon
    bkr_distro: RHEL-7.3
    bkr_host_requires_options: ["arch=x86_64", "memory>=15000"]
    bkr_key_values: ["DISKSPACE>=500000", "HVM=1"]
    bkr_kernel_options: ["selinux=--permisssive", "keyboard=us", "lang=us", "timezone=est"]
    bkr_kernel_post_options: ["isolcpus = 0,5"]
    bkr_tag: "RTT_ACCEPTED"

  - name: Machine from Beaker 4
    provider: beaker
    credential: beaker
    role: bkr-machine
    bkr_jobgroup: ci-ops-pit
    bkr_arch: x86_64
    bkr_variant: Server
    bkr_whiteboard: Testing machine provisioning from Carbon
    bkr_distro: RHEL-7.3
    bkr_host_requires_options: ["arch=x86_64", "memory>=15000"]
    bkr_key_values: ["DISKSPACE>=500000", "HVM=1"]
    bkr_kernel_options: ["selinux=--permisssive", "keyboard=us", "lang=us", "timezone=est"]
    bkr_kernel_post_options: ["isolcpus = 0,5"]
    bkr_tag: "RTT_ACCEPTED"

  - name: Machine from Beaker 5
    provider: beaker
    credential: beaker
    role: bkr-machine
    bkr_jobgroup: ci-ops-pit
    bkr_arch: x86_64
    bkr_variant: Server
    bkr_whiteboard:
    bkr_distro: RHEL-7.3
    bkr_host_requires_options: ["arch=x86_64", "memory>=15000"]
    bkr_key_values: ["DISKSPACE>=500000", "HVM=1"]
    bkr_kernel_options: ["selinux=--permisssive", "keyboard=us", "lang=us", "timezone=est"]
    bkr_kernel_post_options: ["isolcpus = 0,5"]
    bkr_tag: "RTT_ACCEPTED"
    bkr_kickstart: rhel7-7.3-ci-cloud.ks
    bkr_ignore_panic: True
    bkr_timeout: 3600
    bkr_ssh_key: jenkins.keytab-pit-jenkins.rhev-ci-vms.eng.rdu2.redhat.com
    bkr_ksmeta: ["a=b", "c>d"]

  - name: Machine from Beaker 6
    provider: beaker
    credential: beaker
    role: bkr-machine
    bkr_jobgroup: ci-ops-pit
    bkr_arch: x86_64
    bkr_variant: Server
    bkr_whiteboard:
    bkr_distro: RHEL-7.3
    bkr_host_requires_options: ["arch=x86_64", "memory>=15000"]
    bkr_key_values: ["DISKSPACE>=500000", "HVM=1"]
    bkr_kernel_options: ["selinux=--permisssive", "keyboard=us", "lang=us", "timezone=est"]
    bkr_kernel_post_options: ["isolcpus = 0,5"]
    bkr_tag: "RTT_ACCEPTED"
    bkr_ignore_panic: True
    bkr_timeout: 3600
    bkr_virtual_machine: False
    bkr_virt_capable: True
    bkr_distro_requires_options: ["method=nfs", "tag=RTT_ACCEPTED"]
    bkr_priority: Urgent
    bkr_retention_tag: 60days
    bkr_taskparam: [ RESERVETIME=172800 ]
    bkr_ssh_key: pit-jenkins
    bkr_username: root
    bkr_password: ci-ops-pit
    bkr_ksmeta: ["a=b", "c>d"]

orchestrate:

  - name: rhn
    hosts: machine_1, machine_2
    vars:
      host: subscription.rhsm.stage.redhat.com
      username: pit_rhel_workstation_1
      password: EwEBUVYX
      auto-attach: True
      clean: False

  - name: rhn
    hosts: machine_3
    vars:
      host: subscription.rhsm.stage.redhat.com
      username: pit_rhel_server_1
      password: EwEBUAAA
      auto-attach: True
      clean: False
      channels: ['rhel-6-for-system-z-rpms', 'rhel-6-for-system-z-optional-rpms']

  - name: install_packages
    hosts: machine_1, machine_2, machine_3
    vars:
      packages: pexpect, git, wget, python-setuptools, python-devel, restraint-deamon
      group_packages: desktop

execute:

  - framework: restraint
    name: restraint
    vars:
      execute_xml: http://file.bos.redhat.com/~vipatel/FFinterop-rhel6.xml
      role: ['w_client', 's390x_client']

report:

  - type: python
    name: ftp
    vars:
      address: ftp.redhat.com

  - type: playbook
    name: irc
    vars:
      channels: #pit

  - type: notification
    name: email
    vars:
      emails: tmv@redhat.com, vipatel@redhat.com

  - type: test
    name: polarion
    vars:
      host:
      username:
      password:
