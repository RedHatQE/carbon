---
name: FF Interop Test
description: Run an Interop Test against FF

# Credentials
# -----------
# Should we use something like this for credentials??
#
credentials:
  - provision: openstack
    url: http://qeos.lab.eng.rdu2.redhat.com
    site: qeos
    project: project
    user: username
    password: password

# Provision
# ---------
#
# Few definitions to better understand the provision section.
#
#  - Provisioner: this is the tool that will contact a provider to provision a
#                 host. For instance, Linchpin and central-ci-tools.
#
#  - Provider: this is the service or server where the the hosts will be
#              created/managed/deleted.
#
# We may organize provisioners like:
#
#   - carbon.provisioners.linchpin
#   - carbon.provisioners.centralci
#
# We may organize providers like:
#
#   - carbon.providers.beaker
#   - carbon.providers.openstack
#   - carbon.providers.aws
#   - carbon.providers.digitalocean
#
# The main Carbon classes that will manage the provsion section are:
#
#  class CarbonProvider(object):
#
#      def __init__(self, hosts):   # the provisioner will receive a list of hosts
#          implement init
#
#      def validate():              # this will be called in the Validation stage.
#          implement validation
#
#      def create():               # this will be called in the in the Provision stage.
#          implement validation
#
#  class CarbonProvisioner(object):
#
#      def __init__(self, provider, host):   # the provisioner will receive the host to be
#          implement init                    # created and the provider
#
#      def validate():                       # this will be called in the Validation stage.
#          implement validation
#
#      def create():                         # this will be called in the in the Provision stage.
#          implement validation

#
# Implementation would follow:
#
#  class BeakerCarbonProvider(CarbonProvider):
#      ...
#
#  class OpenstackCarbonProvider(CarbonProvider):
#      ...
#
#  class AWSCarbonProvider(CarbonProvider):
#      ...
#
provision:

  - name: machine_1
    provider: openstack
    arch: x86_64
    os_image: rhel-6.9-workstation-x86_64-latest
    variant: Workstation
    os_flavor: medium
    ip_addr:
    role: w_client

  - name: machine_2
    provider: beaker
    arch: i386
    tag: ['RTT_ACCEPTED']
    bkr_family: RedHatEnterpriseLinux6
    bkr_variant: Workstation
    info: client
    ip_addr:
    role: w_client

  - name: machine_3
    provider: beaker
    arch: s390x
    tag: ['RTT_ACCEPTED']
    bkr_family: RedHatEnterpriseLinux6
    bkr_variant: Server
    info: client
    ip_addr:
    role: s390x_client

  - name: machine_4
    provider: openstack
    arch: x86_64
    variant: Server
    os_flavor: medium
    ip_addr:
    role: test_pilot

# Orchestration
# -------------
# This is controlled by the CarbonOchestrator object.
# Initially we use Ansible as our orchestration mechanisms
# and implements accordingly to our needs.
#
# We would organize like:
#
# carbon.orchestrators.ansible
# carbon.orchestrators.puppet     (we won't use puppet, but someone would be able to do this)
# carbon.orchestrators.chef       (we won't use chef, but someone would be able to do this)
#
# class CarbonOchestrator(object):
#
#      def __init__(self, actions_list):   # the orchestrator initialization
#          implement init
#
#      def validate():                     # this will be called in the Validation stage.
#          implement validation
#
#      def run():                          # this will run the orchestration
#          implement running
#
# class AnsibleCarbonOchestrator(CarbonOchestrator):
#
#      def __init__(self, actions_list):   # the orchestration would initiate with a list
#          implement init
#
#      def validate():                     # this will be called in the Validation stage
#          implement validation            # with specific settings about Ansible playbooks
#
#      def run():                          # this will run the orchestration with Ansible,
#          implement running               # and it would follow something like
#                                          #
#                                          # for action in list of actions:
#                                          #   ansible-playbook -H<action.hosts> -D<var_a=action.var_a> -D<var_b=action.var_b> <action.name>.yaml
#
# Things we should be able to do:
#     - add own playbook
#
# For each package, it goes like this:
orchestrate:

  - name: rhn
    hosts: machine_1, machine_2
    vars:
      host: subscription.rhsm.stage.redhat.com
      username: pit_rhel_workstation_1
      password: EwEBUVYX
      auto-attach: True
      clean: False

  - name: rhn
    hosts: machine_3
    vars:
      host: subscription.rhsm.stage.redhat.com
      username: pit_rhel_server_1
      password: EwEBUAAA
      auto-attach: True
      clean: False
      channels: ['rhel-6-for-system-z-rpms', 'rhel-6-for-system-z-optional-rpms']

  - name: carbon_debugging
    hosts: machine_1, machine_2, machine_3
    vars:
      packages: pexpect, git, wget, python-setuptools, python-devel, restraint-deamon
      group_packages: desktop

# Execute Service
# ---------------
# Carbon finds what framework you want to use and execute it using
# the variables it need
execute:
  - name: initial-tests
    framework: restraint
    vars:
      execute_xml: http://file.bos.redhat.com/~vipatel/FFinterop-rhel6.xml
      role: ['w_client', 's390x_client']

# Report Service
# --------------
# At the end of execute, there will be a buch of files that will be
# saved: logs, test results, tracebacks, probes logs, etc
# The report task will find out what module you want to report and
# pass all the artifacts above to it. It is up to the module to
# upload the files, report test results (TCMS, Polarion, etc) and
# notify (IRC, Slack, etc)
report:

  - type: python
    name: ftp
    vars:
      address: ftp.redhat.com

  - type: playbook
    name: irc
    vars:
      channels: #pit

  - type: notification
    name: email
    vars:
      emails: tmv@redhat.com, vipatel@redhat.com

  - type: test
    name: polarion
    vars:
      host:
      username:
      password:
